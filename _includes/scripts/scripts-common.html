<script>
// vim: ts=3

var SHORTCUTS = {};
var SHORTCUTS_AUTOMATIC = {};
var SHORTCUTS_MANUAL = {};
var SHORTCUTS_BOTH = {};
var LIST_AUTOMATIC = [];
var LIST_MANUAL = [];
var LIST_BOTH = [];
var LIST = [];



//////////////////////////////
//
// HighlightLinkInHeader --
//   border-bottom: 2px solid #8c1515;
//

function HighlightLinkInHeader() {
	var element = document.querySelector("ul.highlight");
	if (!element) {
		return;
	}

	var list = element.querySelectorAll("li a");
	var target = window.location.pathname.replace(/\/$/, "");
	for (var i=0; i<list.length; i++) {
		var location = list[i].pathname.replace(/\/$/, "");
		if (location === target) {
			list[i].style.borderBottom = "2px solid #8c1515";
		} else {
			list[i].style.borderBottom = "2px solid #f2f1eb";
		}
		if (list[i].textContent.match(/About/)) {
			list[i].style.borderBottom = "2px solid #f2f1eb";
		}
	}
}



//////////////////////////////
//
// GetCgiParameters -- Returns an associative array containing the
//     page's URL's CGI parameters
//

function GetCgiParameters() {
   var url = window.location.search.substring(1);
   var output = {};
   var settings = url.split('&');
   for (var i=0; i<settings.length; i++) {
      var pair = settings[i].split('=');
      pair[0] = decodeURIComponent(pair[0]);
      pair[1] = decodeURIComponent(pair[1]);
      if (typeof output[pair[0]] === 'undefined') {
         output[pair[0]] = pair[1];
      } else if (typeof output[pair[0]] === 'string') {
         var arr = [ output[pair[0]], pair[1] ];
         output[pair[0]] = arr;
      } else {
         output[pair[0]].push(pair[1]);
      }
   }
   return output;
}



//////////////////////////////
//
// PrepareMenuIndexBoth --
//

function PrepareMenuIndexBoth(text) {
	var shortcuts = {};
	var list = [];
	var lines  = text.match(/[^\r\n]+/g);
	var headerLine = -1;
	var headers = [];
	var i;
	var output = {};
	var cells;
	for (i=0; i<lines.length; i++) {
		cells = lines[i].split(/\t/);
		if (!cells[0].match(/^\s*LEVEL_1\s*$/i)) {
			continue;
		}
		headerLine = i;
		headers = cells;
		break;
	}
	if (headerLine < 0) {
		return {};
	}
	var columns = {};
	for (i=0; i<cells.length; i++) {
		columns[cells[i]] = i;
	}
	var shortcut;
	var dataurl;
	var url;
	var level1;
	var level2;
	var level3;
	var level4;
	var level5;
	var max;
	var obj;
	for (i=headerLine+1; i<lines.length; i++) {
		cells = lines[i].split(/\t/);
		if (cells.length < 1) {
			continue;
		}
		if (cells[0].match(/^\s*$/)) {
			continue;
		}
		level1   = cells[columns["LEVEL_1"]]  || "";
		level2   = cells[columns["LEVEL_2"]]  || "";
		level3   = cells[columns["LEVEL_3"]]  || "";
		level4   = cells[columns["LEVEL_4"]]  || "";
		level5   = cells[columns["LEVEL_5"]]  || "";
		shortcut = cells[columns["SHORTCUT"]] || "";
		dataurl  = cells[columns["DATA_URL"]] || "";
		url      = cells[columns["URL"]] || "";
		level1   = level1.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level2   = level2.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level3   = level3.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level4   = level4.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level5   = level5.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		if (shortcut.match(/^\s*$/)) { continue; }
		if (dataurl.match(/^\s*$/)) { continue; }
		if (!level5.match(/^\s*$/)) { max = 5; }
		else if (!level4.match(/^\s*$/)) { max = 4; }
		else if (!level3.match(/^\s*$/)) { max = 3; }
		else if (!level2.match(/^\s*$/)) { max = 2; }
		else if (!level1.match(/^\s*$/)) { max = 1; }
		if (max < 2) {
			continue;
		}
		if (max == 5) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1 }; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			if (!output[level1][level2][level3][level4]) { 
				output[level1][level2][level3][level4] = { "@level": 4, "@line":i, "@title":level4}; 
			}
			if (!output[level1][level2][level3][level4][level5]) { 
				output[level1][level2][level3][level4][level5] = { "@level": 5, "@line":i, "@title":level5}; 
			}
			obj = output[level1][level2][level3][level4][level5];
		} else if (max == 4) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			if (!output[level1][level2][level3][level4]) { 
				output[level1][level2][level3][level4] = { "@level": 4, "@line":i, "@title":level4}; 
			}
			obj = output[level1][level2][level3][level4];
		} else if (max == 3) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			obj = output[level1][level2][level3];
		} else if (max == 2) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			obj = output[level1][level2];
		} else {
			continue;
		}
		obj.shortcut = shortcut.replace(/\s+/g, "");
		obj.dataurl = dataurl;
		obj.url = url;
		obj["@line"] = i;
		obj["@path"] = [];
		if (!level1.match(/^\s*$/)) {
			obj["@path"].push(output[level1]);
			if (!level2.match(/^\s*$/)) {
				obj["@path"].push(output[level1][level2]);
				if (!level3.match(/^\s*$/)) {
					obj["@path"].push(output[level1][level2][level3]);
					if (!level4.match(/^\s*$/)) {
						obj["@path"].push(output[level1][level2][level3][level4]);
						if (!level5.match(/^\s*$/)) {
							obj["@path"].push(output[level1][level2][level3][level4][level5]);
						}
					}
				}
			}
		}
		if (shortcuts[obj.shortcut]) {
			console.log("WARNING: shortcut", shortcut, "already exists:", shortcuts[obj.shortcut]);
		} else {
			shortcuts[obj.shortcut] = obj;
		}
		list.push(obj);
	}
	LIST_BOTH = list;
	SHORTCUTS_BOTH = shortcuts;
	return output;
}



//////////////////////////////
//
// PrepareMenuIndexAutomatic -- Only keep automatic typesetting (not .iff).
//

function PrepareMenuIndexAutomatic(text) {
	var shortcuts = {};
	var list = [];
	var lines  = text.match(/[^\r\n]+/g);
	var headerLine = -1;
	var headers = [];
	var i;
	var output = {};
	var cells;
	for (i=0; i<lines.length; i++) {
		cells = lines[i].split(/\t/);
		if (!cells[0].match(/^\s*LEVEL_1\s*$/i)) {
			continue;
		}
		headerLine = i;
		headers = cells;
		break;
	}
	if (headerLine < 0) {
		return {};
	}
	var columns = {};
	for (i=0; i<cells.length; i++) {
		columns[cells[i]] = i;
	}
	var shortcut;
	var dataurl;
	var url;
	var level1;
	var level2;
	var level3;
	var level4;
	var level5;
	var max;
	var obj;
	for (i=headerLine+1; i<lines.length; i++) {
		if (lines[i].match(/\.iff/)) {
			continue;
		}
		cells = lines[i].split(/\t/);
		if (cells.length < 1) {
			continue;
		}
		if (cells[0].match(/^\s*$/)) {
			continue;
		}
		level1   = cells[columns["LEVEL_1"]]  || "";
		level2   = cells[columns["LEVEL_2"]]  || "";
		level3   = cells[columns["LEVEL_3"]]  || "";
		level4   = cells[columns["LEVEL_4"]]  || "";
		level5   = cells[columns["LEVEL_5"]]  || "";
		shortcut = cells[columns["SHORTCUT"]] || "";
		dataurl  = cells[columns["DATA_URL"]] || "";
		url      = cells[columns["URL"]] || "";
		level1   = level1.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level2   = level2.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level3   = level3.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level4   = level4.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level5   = level5.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		if (shortcut.match(/^\s*$/)) { continue; }
		if (dataurl.match(/^\s*$/)) { continue; }
		if (!level5.match(/^\s*$/)) { max = 5; }
		else if (!level4.match(/^\s*$/)) { max = 4; }
		else if (!level3.match(/^\s*$/)) { max = 3; }
		else if (!level2.match(/^\s*$/)) { max = 2; }
		else if (!level1.match(/^\s*$/)) { max = 1; }
		if (max < 2) {
			continue;
		}
		if (max == 5) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1 }; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			if (!output[level1][level2][level3][level4]) { 
				output[level1][level2][level3][level4] = { "@level": 4, "@line":i, "@title":level4}; 
			}
			if (!output[level1][level2][level3][level4][level5]) { 
				output[level1][level2][level3][level4][level5] = { "@level": 5, "@line":i, "@title":level5}; 
			}
			obj = output[level1][level2][level3][level4][level5];
		} else if (max == 4) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			if (!output[level1][level2][level3][level4]) { 
				output[level1][level2][level3][level4] = { "@level": 4, "@line":i, "@title":level4}; 
			}
			obj = output[level1][level2][level3][level4];
		} else if (max == 3) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			obj = output[level1][level2][level3];
		} else if (max == 2) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			obj = output[level1][level2];
		} else {
			continue;
		}
		obj.shortcut = shortcut.replace(/\s+/g, "");
		obj.dataurl = dataurl;
		obj.url = url;
		obj["@line"] = i;
		obj["@path"] = [];
		if (!level1.match(/^\s*$/)) {
			obj["@path"].push(output[level1]);
			if (!level2.match(/^\s*$/)) {
				obj["@path"].push(output[level1][level2]);
				if (!level3.match(/^\s*$/)) {
					obj["@path"].push(output[level1][level2][level3]);
					if (!level4.match(/^\s*$/)) {
						obj["@path"].push(output[level1][level2][level3][level4]);
						if (!level5.match(/^\s*$/)) {
							obj["@path"].push(output[level1][level2][level3][level4][level5]);
						}
					}
				}
			}
		}
		if (shortcuts[obj.shortcut]) {
			console.log("WARNING: shortcut", shortcut, "already exists:", shortcuts[obj.shortcut]);
		} else {
			shortcuts[obj.shortcut] = obj;
		}
		list.push(obj);
	}
	LIST_AUTOMATIC = list;
	SHORTCUTS_AUTOMATIC = shortcuts;
	return output;
}



//////////////////////////////
//
// PrepareMenuIndexManual -- Only keep manual typesetting (.iff).
//

function PrepareMenuIndexManual(text) {
	var shortcuts = {};
	var list = [];
	var lines  = text.match(/[^\r\n]+/g);
	var headerLine = -1;
	var headers = [];
	var i;
	var output = {};
	var cells;
	for (i=0; i<lines.length; i++) {
		cells = lines[i].split(/\t/);
		if (!cells[0].match(/^\s*LEVEL_1\s*$/i)) {
			continue;
		}
		headerLine = i;
		headers = cells;
		break;
	}
	if (headerLine < 0) {
		return {};
	}
	var columns = {};
	for (i=0; i<cells.length; i++) {
		columns[cells[i]] = i;
	}
	var shortcut;
	var dataurl;
	var url;
	var level1;
	var level2;
	var level3;
	var level4;
	var level5;
	var max;
	var obj;
	for (i=headerLine+1; i<lines.length; i++) {
		if (!lines[i].match(/\.iff/)) {
			continue;
		}
		cells = lines[i].split(/\t/);
		if (cells.length < 1) {
			continue;
		}
		if (cells[0].match(/^\s*$/)) {
			continue;
		}
		level1   = cells[columns["LEVEL_1"]]  || "";
		level2   = cells[columns["LEVEL_2"]]  || "";
		level3   = cells[columns["LEVEL_3"]]  || "";
		level4   = cells[columns["LEVEL_4"]]  || "";
		level5   = cells[columns["LEVEL_5"]]  || "";
		shortcut = cells[columns["SHORTCUT"]] || "";
		dataurl  = cells[columns["DATA_URL"]] || "";
		url      = cells[columns["URL"]] || "";
		level1   = level1.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level2   = level2.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level3   = level3.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level4   = level4.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		level5   = level5.replace(/^\s+/, "").replace(/^\s+$/, "").replace(/'/g, "ZZZ");
		if (shortcut.match(/^\s*$/)) { continue; }
		if (dataurl.match(/^\s*$/)) { continue; }
		if (!level5.match(/^\s*$/)) { max = 5; }
		else if (!level4.match(/^\s*$/)) { max = 4; }
		else if (!level3.match(/^\s*$/)) { max = 3; }
		else if (!level2.match(/^\s*$/)) { max = 2; }
		else if (!level1.match(/^\s*$/)) { max = 1; }
		if (max < 2) {
			continue;
		}
		if (max == 5) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1 }; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			if (!output[level1][level2][level3][level4]) { 
				output[level1][level2][level3][level4] = { "@level": 4, "@line":i, "@title":level4}; 
			}
			if (!output[level1][level2][level3][level4][level5]) { 
				output[level1][level2][level3][level4][level5] = { "@level": 5, "@line":i, "@title":level5}; 
			}
			obj = output[level1][level2][level3][level4][level5];
		} else if (max == 4) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			if (!output[level1][level2][level3][level4]) { 
				output[level1][level2][level3][level4] = { "@level": 4, "@line":i, "@title":level4}; 
			}
			obj = output[level1][level2][level3][level4];
		} else if (max == 3) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			if (!output[level1][level2][level3]) { 
				output[level1][level2][level3] = { "@level": 3, "@line":i, "@title":level3}; 
			}
			obj = output[level1][level2][level3];
		} else if (max == 2) {
			if (!output[level1]) { 
				output[level1] = { "@level": 1, "@line":i, "@title":level1}; 
			}
			if (!output[level1][level2]) { 
				output[level1][level2] = { "@level": 2, "@line":i, "@title":level2}; 
			}
			obj = output[level1][level2];
		} else {
			continue;
		}
		obj.shortcut = shortcut.replace(/\s+/g, "");
		obj.dataurl = dataurl;
		obj.url = url;
		obj["@line"] = i;
		obj["@path"] = [];
		if (!level1.match(/^\s*$/)) {
			obj["@path"].push(output[level1]);
			if (!level2.match(/^\s*$/)) {
				obj["@path"].push(output[level1][level2]);
				if (!level3.match(/^\s*$/)) {
					obj["@path"].push(output[level1][level2][level3]);
					if (!level4.match(/^\s*$/)) {
						obj["@path"].push(output[level1][level2][level3][level4]);
						if (!level5.match(/^\s*$/)) {
							obj["@path"].push(output[level1][level2][level3][level4][level5]);
						}
					}
				}
			}
		}
		if (shortcuts[obj.shortcut]) {
			console.log("WARNING: shortcut", shortcut, "already exists:", shortcuts[obj.shortcut]);
		} else {
			shortcuts[obj.shortcut] = obj;
		}
		list.push(obj);
	}
	LIST_MANUAL = list;
	SHORTCUTS_MANUAL = shortcuts;
	return output;
}




</script>

